Started by user [8mha:////4K5wFlcXmJC0DsPJ4mF2W0rBte8CK1/5fcgVP9EWRDhLAAAAlx+LCAAAAAAAAP9b85aBtbiIQTGjNKU4P08vOT+vOD8nVc83PyU1x6OyILUoJzMv2y+/JJUBAhiZGBgqihhk0NSjKDWzXb3RdlLBUSYGJk8GtpzUvPSSDB8G5tKinBIGIZ+sxLJE/ZzEvHT94JKizLx0a6BxUmjGOUNodHsLgAzWEgZu/dLi1CL9xJTczDwAj6GcLcAAAAA=[0madmin
Building in workspace /home/ubuntu/.jenkins/workspace/cluster-provision
[cluster-provision] $ /bin/bash /tmp/jenkins2939127226010538538.sh
aws-cli/1.16.155 Python/3.6.7 Linux/4.15.0-1032-aws botocore/1.12.145
aws-cli/1.16.155 Python/3.6.7 Linux/4.15.0-1032-aws botocore/1.12.145
number of workers to be created 1
region selected eu-central-1
size of instance selected t2.small
ami-0d741ed58ca5b342e
inserting values in cfn template
creating vpc and subnet
{
    "StackId": "arn:aws:cloudformation:eu-central-1:828164643967:stack/demo/066e77a0-7333-11e9-86c4-020300f3c01c"
}
displaying the subnets and vpc created
vpc-0be903d426c805bab
subnet-0b5ecf0676c275d10
subnet-008cc443302f2ed5b
subnet-0fa8ec3bdef69366c
sg-06b079e221b97e621
create eks cluster
{
    "cluster": {
        "name": "demo",
        "arn": "arn:aws:eks:eu-central-1:828164643967:cluster/demo",
        "createdAt": 1557499967.02,
        "version": "1.12",
        "roleArn": "arn:aws:iam::828164643967:role/eksCluster-cap",
        "resourcesVpcConfig": {
            "subnetIds": [
                "subnet-0b5ecf0676c275d10",
                "subnet-008cc443302f2ed5b",
                "subnet-0fa8ec3bdef69366c"
            ],
            "securityGroupIds": [
                "sg-06b079e221b97e621"
            ],
            "vpcId": "vpc-0be903d426c805bab",
            "endpointPublicAccess": true,
            "endpointPrivateAccess": false
        },
        "logging": {
            "clusterLogging": [
                {
                    "types": [
                        "api",
                        "audit",
                        "authenticator",
                        "controllerManager",
                        "scheduler"
                    ],
                    "enabled": false
                }
            ]
        },
        "status": "CREATING",
        "certificateAuthority": {},
        "platformVersion": "eks.1"
    }
}
cluster status
"ACTIVE"
Updated context arn:aws:eks:eu-central-1:828164643967:cluster/demo in /home/ubuntu/.kube/config
NAME         TYPE        CLUSTER-IP   EXTERNAL-IP   PORT(S)   AGE
kubernetes   ClusterIP   10.100.0.1   <none>        443/TCP   3m6s
create nodes for the cluster
{
    "StackId": "arn:aws:cloudformation:eu-central-1:828164643967:stack/demo-nodes/1fa171f0-72fc-11e9-ac93-066084ff6f3a"
}
{
    "Stacks": [
        {
            "StackId": "arn:aws:cloudformation:eu-central-1:828164643967:stack/demo-nodes/1fa171f0-72fc-11e9-ac93-066084ff6f3a",
            "StackName": "demo-nodes",
            "Description": "Amazon EKS - Node Group",
            "Parameters": [
                {
                    "ParameterKey": "NodeGroupName",
                    "ParameterValue": "demo-nodes"
                },
                {
                    "ParameterKey": "ClusterControlPlaneSecurityGroup",
                    "ParameterValue": "sg-06b079e221b97e621"
                },
                {
                    "ParameterKey": "NodeAutoScalingGroupMinSize",
                    "ParameterValue": "1"
                },
                {
                    "ParameterKey": "NodeInstanceType",
                    "ParameterValue": "t2.small"
                },
                {
                    "ParameterKey": "NodeAutoScalingGroupMaxSize",
                    "ParameterValue": "4"
                },
                {
                    "ParameterKey": "KeyName",
                    "ParameterValue": "cap-eu-central-1"
                },
                {
                    "ParameterKey": "NodeImageId",
                    "ParameterValue": "ami-0d741ed58ca5b342e"
                },
                {
                    "ParameterKey": "Subnets",
                    "ParameterValue": "subnet-0b5ecf0676c275d10,subnet-008cc443302f2ed5b,subnet-0fa8ec3bdef69366c"
                },
                {
                    "ParameterKey": "NodeVolumeSize",
                    "ParameterValue": "20"
                },
                {
                    "ParameterKey": "VpcId",
                    "ParameterValue": "vpc-0be903d426c805bab"
                },
                {
                    "ParameterKey": "ClusterName",
                    "ParameterValue": "demo"
                },
                {
                    "ParameterKey": "BootstrapArguments",
                    "ParameterValue": ""
                },
                {
                    "ParameterKey": "NodeAutoScalingGroupDesiredCapacity",
                    "ParameterValue": "1"
                }
            ],
            "CreationTime": "2019-05-10T15:03:42.172Z",
            "RollbackConfiguration": {},
            "StackStatus": "CREATE_IN_PROGRESS",
            "DisableRollback": false,
            "NotificationARNs": [],
            "Capabilities": [
                "CAPABILITY_IAM"
            ],
            "Tags": [],
            "EnableTerminationProtection": false,
            "DriftInformation": {
                "StackDriftStatus": "NOT_CHECKED"
            }
        }
    ]
}
adding workers to cluster
arn:aws:iam::828164643967:role/demo-nodes-NodeInstanceRole-8ZNIC7PECI1V
Error from server (NotFound): error when deleting "aws-auth-cm.yaml": configmaps "aws-auth" not found
configmap/aws-auth created
NAME                                               STATUS     ROLES    AGE   VERSION
ip-192-168-223-163.eu-central-1.compute.internal   NotReady   <none>   16s   v1.12.7
Client Version: version.Info{Major:"1", Minor:"12", GitVersion:"v1.12.2", GitCommit:"17c77c7898218073f14c8d573582e8d2313dc740", GitTreeState:"clean", BuildDate:"2018-10-24T06:54:59Z", GoVersion:"go1.10.4", Compiler:"gc", Platform:"linux/amd64"}
Server Version: version.Info{Major:"1", Minor:"12+", GitVersion:"v1.12.6-eks-d69f1b", GitCommit:"d69f1bf3669bf00b7f4a758e978e0e7a1e3a68f7", GitTreeState:"clean", BuildDate:"2019-02-28T20:26:10Z", GoVersion:"go1.10.8", Compiler:"gc", Platform:"linux/amd64"}
pushing to github
Cloning into 'eks-app-platform-config'...
On branch master
Your branch is up to date with 'origin/master'.

Changes to be committed:
  (use "git reset HEAD <file>..." to unstage)

	new file:   demo-eu-central-1/cluster_info.json
	new file:   demo-eu-central-1/worker_nodes

[master b10b0c6] files
 Committer: Ubuntu <ubuntu@ip-172-31-25-97.us-east-2.compute.internal>
Your name and email address were configured automatically based
on your username and hostname. Please check that they are accurate.
You can suppress this message by setting them explicitly. Run the
following command and follow the instructions in your editor to edit
your configuration file:

    git config --global --edit

After doing this, you may fix the identity used for this commit with:

    git commit --amend --reset-author

 2 files changed, 44 insertions(+)
 create mode 100644 demo-eu-central-1/cluster_info.json
 create mode 100644 demo-eu-central-1/worker_nodes
To https://github.com/nagarajui7/eks-app-platform-config.git
   dd948d7..b10b0c6  master -> master
Finished: SUCCESS
