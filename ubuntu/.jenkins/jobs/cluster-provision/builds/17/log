Started by user [8mha:////4K5wFlcXmJC0DsPJ4mF2W0rBte8CK1/5fcgVP9EWRDhLAAAAlx+LCAAAAAAAAP9b85aBtbiIQTGjNKU4P08vOT+vOD8nVc83PyU1x6OyILUoJzMv2y+/JJUBAhiZGBgqihhk0NSjKDWzXb3RdlLBUSYGJk8GtpzUvPSSDB8G5tKinBIGIZ+sxLJE/ZzEvHT94JKizLx0a6BxUmjGOUNodHsLgAzWEgZu/dLi1CL9xJTczDwAj6GcLcAAAAA=[0madmin
Building in workspace /home/ubuntu/.jenkins/workspace/cluster-provision
[cluster-provision] $ /bin/sh -xe /tmp/jenkins549324033736568666.sh
+ aws --version
aws-cli/1.16.155 Python/3.6.7 Linux/4.15.0-1032-aws botocore/1.12.145
+ cd /home/ubuntu
+ ./cluster-setup.sh 1 eu-west-1 t2.small demo
aws-cli/1.16.155 Python/3.6.7 Linux/4.15.0-1032-aws botocore/1.12.145
number of workers to be created 1
region selected eu-west-1
size of instance selected t2.small
ami-08716b70cac884aaa
inserting values in cfn template
creating vpc and subnet
{
    "StackId": "arn:aws:cloudformation:eu-west-1:828164643967:stack/demo/832bfe80-7305-11e9-bc45-0233b49b0800"
}
displaying the subnets and vpc created
vpc-004448f7aef8dbbb5
subnet-01c704c862dd8d282
subnet-03230cf99c7746272
subnet-0192a1e0ecc924716
sg-01e3e4e80a168a04e
create eks cluster
{
    "cluster": {
        "name": "demo",
        "arn": "arn:aws:eks:eu-west-1:828164643967:cluster/demo",
        "createdAt": 1557480418.927,
        "version": "1.12",
        "roleArn": "arn:aws:iam::828164643967:role/eksCluster-cap",
        "resourcesVpcConfig": {
            "subnetIds": [
                "subnet-01c704c862dd8d282",
                "subnet-03230cf99c7746272",
                "subnet-0192a1e0ecc924716"
            ],
            "securityGroupIds": [
                "sg-01e3e4e80a168a04e"
            ],
            "vpcId": "vpc-004448f7aef8dbbb5",
            "endpointPublicAccess": true,
            "endpointPrivateAccess": false
        },
        "logging": {
            "clusterLogging": [
                {
                    "types": [
                        "api",
                        "audit",
                        "authenticator",
                        "controllerManager",
                        "scheduler"
                    ],
                    "enabled": false
                }
            ]
        },
        "status": "CREATING",
        "certificateAuthority": {},
        "platformVersion": "eks.1"
    }
}
cluster status
"ACTIVE"
Added new context arn:aws:eks:eu-west-1:828164643967:cluster/demo to /home/ubuntu/.kube/config
NAME         TYPE        CLUSTER-IP   EXTERNAL-IP   PORT(S)   AGE
kubernetes   ClusterIP   10.100.0.1   <none>        443/TCP   2m41s
create nodes for the cluster
{
    "StackId": "arn:aws:cloudformation:eu-west-1:828164643967:stack/demo-nodes/70a6d740-72ff-11e9-bbd1-0a4189c8dbd8"
}
{
    "Stacks": [
        {
            "StackId": "arn:aws:cloudformation:eu-west-1:828164643967:stack/demo-nodes/70a6d740-72ff-11e9-bbd1-0a4189c8dbd8",
            "StackName": "demo-nodes",
            "Description": "Amazon EKS - Node Group",
            "Parameters": [
                {
                    "ParameterKey": "NodeGroupName",
                    "ParameterValue": "demo-nodes"
                },
                {
                    "ParameterKey": "ClusterControlPlaneSecurityGroup",
                    "ParameterValue": "sg-01e3e4e80a168a04e"
                },
                {
                    "ParameterKey": "NodeAutoScalingGroupMinSize",
                    "ParameterValue": "1"
                },
                {
                    "ParameterKey": "NodeInstanceType",
                    "ParameterValue": "t2.small"
                },
                {
                    "ParameterKey": "NodeAutoScalingGroupMaxSize",
                    "ParameterValue": "4"
                },
                {
                    "ParameterKey": "KeyName",
                    "ParameterValue": "cap-eu-west-1"
                },
                {
                    "ParameterKey": "NodeImageId",
                    "ParameterValue": "ami-08716b70cac884aaa"
                },
                {
                    "ParameterKey": "Subnets",
                    "ParameterValue": "subnet-01c704c862dd8d282,subnet-03230cf99c7746272,subnet-0192a1e0ecc924716"
                },
                {
                    "ParameterKey": "NodeVolumeSize",
                    "ParameterValue": "20"
                },
                {
                    "ParameterKey": "VpcId",
                    "ParameterValue": "vpc-004448f7aef8dbbb5"
                },
                {
                    "ParameterKey": "ClusterName",
                    "ParameterValue": "demo"
                },
                {
                    "ParameterKey": "BootstrapArguments",
                    "ParameterValue": ""
                },
                {
                    "ParameterKey": "NodeAutoScalingGroupDesiredCapacity",
                    "ParameterValue": "1"
                }
            ],
            "CreationTime": "2019-05-10T09:37:53.859Z",
            "RollbackConfiguration": {},
            "StackStatus": "CREATE_IN_PROGRESS",
            "DisableRollback": false,
            "NotificationARNs": [],
            "Capabilities": [
                "CAPABILITY_IAM"
            ],
            "Tags": [],
            "EnableTerminationProtection": false,
            "DriftInformation": {
                "StackDriftStatus": "NOT_CHECKED"
            }
        }
    ]
}
adding workers to cluster
arn:aws:iam::828164643967:role/demo-nodes-NodeInstanceRole-23YFKZMRU592
Error from server (NotFound): error when deleting "aws-auth-cm.yaml": configmaps "aws-auth" not found
configmap/aws-auth created
NAME                                            STATUS     ROLES    AGE   VERSION
ip-192-168-136-199.eu-west-1.compute.internal   NotReady   <none>   4s    v1.12.7
Client Version: version.Info{Major:"1", Minor:"12", GitVersion:"v1.12.2", GitCommit:"17c77c7898218073f14c8d573582e8d2313dc740", GitTreeState:"clean", BuildDate:"2018-10-24T06:54:59Z", GoVersion:"go1.10.4", Compiler:"gc", Platform:"linux/amd64"}
Server Version: version.Info{Major:"1", Minor:"12+", GitVersion:"v1.12.6-eks-d69f1b", GitCommit:"d69f1bf3669bf00b7f4a758e978e0e7a1e3a68f7", GitTreeState:"clean", BuildDate:"2019-02-28T20:26:10Z", GoVersion:"go1.10.8", Compiler:"gc", Platform:"linux/amd64"}
Finished: SUCCESS
